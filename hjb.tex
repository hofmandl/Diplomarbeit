
\chapter{Portfoliooptimierung unter Crashgefahr: Der HJB-Ansatz}
\section{Formulierung der Problemstellung}
Wir gehen wieder von unserem Standardfinanzmarktmodell aus \ref{Standardfinanzmarktmodell} aus. Wir betrachten dann zusätzlich noch einen Sprungprozess $N$, der auf dem Intervall
$\left[0,T  \right]$ genau einen Sprung von 0 auf 1 macht. Damit modellieren wir die Möglichkeit des Aktienkurses zu crashen. Ähnlich wie beim vorher betrachteten Lösungsanstz
führen wir wieder einen Parameter $k$ ein, der die Höhe des Crashes angibt.
Der Preis des Aktienkurs ist dann gegeben durch: 
\begin{align}
 dS(t) &= S(t-)(\mu dt + \sigma dW(t) - k dN(t)) \\
  S(0) &= s_0
\end{align}
Denn Nutzen aus dem Endvermögen T wollen wir nun mittels einer MaxMin-Strategie maximieren. Mit den folgenden Definitionen nachen wir unsere Absicht präzis.


\begin{myDefinition} \label{def:Handelstrategien}
Crashprozesse sind alle auf $\Omega$ definierten Prozesse, die an die Filtrierung der Brownschen Bewegung adaptiert
sind und genau einmal von 0 auf 1 springen zwischen t und T. Wir bezeichnen sie mit $\mathcal{B}(t)$.
\end{myDefinition}

Crashprozesse sind also an die Brownsche Filtrierung adaptierte Prozesse definiert. Damit sind insbesondere alle konstanten Crashzeiten abgedeckt, aber auch solche, die auf eine
(an die Brownsche Filtreirung) adaptierte Handelstrategie reagieren. Bei unserem MinMax-Ansatz, suchen wir eine Strategie, bei der der minimale erwartete Nutzen unter allen
möglichkeiten Crashzeiten maximiert wird. Unter diesem Gesichtspunkt ist unsere Menge von Crashzeiten also schon relativ groß und wir verzichten auf die Berücksichtigung
von Crashzeiten, die ganz anderen Zufallsprinzipien folgen.

Jeder Crashprozess $N$ definiert eine Stoppzeit $\tau = \inf \{ t; N(t)=1 \}$ und jede Stoppzeit $\tau$ definiert einen Crashprozess $\mathbf{1}_{\left[\tau,T \right]}$ Wir werden
daher $\tau$ und $N$ im folgenden austauschbar benutzen.

\begin{myDefinition} \label{def:Handelstrategien}
Wir bezeichen mit $X_{\tau,\pi,t_0,x_0}$ die Lösung der von $\tau$ und $\pi$ kontrollierten Vermögensgleichung.
\begin{align}
 dX(t) &= X(t)(r dt + \pi(t)(\mu -r) dt + \sigma dW(t) -k dN(t)) \\
  X(t_0) &= x_0
\end{align}
\end{myDefinition}
Mit unserem Wissen über die Lösung dieses Differentialgleichung ohne $N$ können wir auch die Lösung dieser Diffenrentailgleichung ganz konkret angeben. Es gilt nämlich:
\begin{equation}
 X_{\tau,\pi,t_0,x_0}(t) = X_{\pi,t_0,x_0}(t) \left( 1 - \mathbf{1}_{\left[\tau,T\right]} \pi(\tau) k \right)
\end{equation} 
Der Prozess  $X_{\tau,\pi,t_0,x_0}$ folgt also im wesentlichen der Dynamik im crasfreien Setting; vor dem Crash sind sie gleich, nach dem Crash unterscheiden sie sich um einen
Faktor. Insbeondere gilt:
\begin{equation}
 X_{\tau,\pi,t_0,x_0}(\tau) = X_{\pi,t_0,x_0}(\tau) \left( 1 - \pi(\tau) k \right) = X_{\tau, \pi,t_0,x_0}(\tau-) \left( 1 - \pi(\tau) k \right)
\end{equation} 


Ohne $N$ ist $X$ on  Ito-Diffusion. Den Generator von $(t,X(t))$ geben wir in der folgenden Definition einen Namen:
\begin{myDefinition} 
\begin{equation} \label{eq:Generator}
 \mathcal{L}^{\pi} v(t,x) = v_t(t,x) + v_x(t,x)(r+\pi(t,x)(\mu-r)) x + \einhalb v_{xx}(t,x) (\pi(t,x))^2
\sigma^2 x^2
\end{equation}
\end{myDefinition}




\begin{myDefinition} \label{Worst-Case-portfoliooptimerungsproblem2}
Sei $N \in \mathcal{B}(t)$. Wir bezeichnen mit 
\begin{equation} 
 J^1(t,x,\pi,N) := E \left[ U(X_{\pi,N,t,x}(T)) \right] 
\end{equation}
den erwarteten Endnutzen durch Verfolgung von $\pi$ und dem Crashscenario $N$. 
Wir nennen die Aufgabe
\begin{equation}
  \text{maximiere}  \inf_{N \in \mathcal{B}(t)} J^1(t,x,\pi,N)
\end{equation}
das Worst-Case-Portfoliooptimierunsproblem 2. Die Funktion
\begin{equation}
 V^1(t,x)= \sup_{\pi \in \mathcal{A}(t,x)} \inf_{N \in \mathcal{B}(t)} J^1(t,x,\pi,N)
\end{equation}
heißt Wertfunktion des Problems und eine Handelsstrategie für die das Surpremum angenommen wird heißt
optimale Strategie für $(t,x)$.
\end{myDefinition}

Schon in der Notation erkennt man die Analogie zum Standard Portfoliooptimierungsproblem aus Definition \ref{def:Standardportfoliooptimierungsproblem}. Dafür kennen wir schon 
einen Verifikationssatz für die Wertfunktion und die optimale Strategie. Im folgenden wird es unser Ziel sein einen analogen Verifikationssatz für diese Erweuterung zu formulieren
und zu beweisen. Dieses Problem hat einen anderen Namen bekommen als das Worst-Case-Portfoliooptimierungsproblem 1 aus Definition \ref{def:WCPortfolioproblem1}. Zwar wurde genau
die gleiche Idee formuliert, aber die Modellierung ist ganz unterschiedlich. Für den logaritmischen Nutzen werden wir dennoch zeigen, dass beide Formulierungen zur gleichen
optimalen Strategie führen. 

% Erster Teil des Verifikationsatzes
% Sei
% \begin{equation}
%  G=\left[0,T \right] \times \mathbb{R}^+
% \end{equation}
% 
% 
% Wir formulieren nun einen Verifikationsatz. Sei $v^0$ eine Lösung von
% \begin{align}
%  0 &= \sup_{\pi \in R } \left[ \mathcal{L}^{\pi} v^0(t,x) \right] \\
%  v^0(T,x) &= U(x)
% \end{align}
% und sei $p$ eine zulässige Handeslstrategie mit
% \begin{equation}
%  \mathcal{L}^{p(t,x)} v^0(t,x) = 0
% \end{equation}
% 
% Dann gilt $V^0(t,x) = v^0(t,x)$ und $p$ ist die optimale Strategie.

Zunächst beweisen wir ein Lemma, wie $V^1$ charaktriesert werden kann.

\begin{mySatz} \label{th:Bellmanprinzip}
 \begin{align}
 V^1(t,x) &=  \sup_{\pi \in \mathcal{A}(t,x)} \inf_{N \in \mathcal{B}(t)}    E_{t,x,n} \left[ U(X^{\pi \tau}(T)) \right] \\
          &=  \inf_{N \in \mathcal{B}(t)}   \sup_{\pi \in \mathcal{A}(t,x)}  E_{t,x,n}  \left[ U(X^{\pi \tau}(T)) \right] \\
%          &=  \sup_{\pi \in \mathcal{A}} \inf_{\tau}  E_{t,x,n}  \left[  V^0(\tau,X^{\pi \tau}(\tau-)(1-k \pi(\tau)))  \right]\\
%          &=  \inf_{\tau}   \sup_{\pi \in \mathcal{A}}  E_{t,x,n}  \left[  V^0(\tau,X^{\pi \tau}(\tau-)(1-k \pi(\tau)))  \right]\\
%          &=  \sup_{\pi \in \mathcal{A}} \inf_{\tau}  E_{t,x,n}  \left[  V^0(\tau,X^{\pi \tau}(\tau))  \right]\\
          &=  \inf_{\tau}   \sup_{\pi \in \mathcal{A}(t,x)}  E_{t,x,n}  \left[  V^0(\tau,X^{\pi \tau}(\tau))  \right]\\
\end{align}
\end{mySatz}

\begin{proof}
 
% Aus dem Beweis, den Teil halte ich aber für überflüssig.
% Wie wenden 4 mal die $\epsilon$-Charactersierung des Surprememus an:
% \begin{equation}
% \begin{split}
%        & \sup_{\pi}  E_{t,x,n} \left[   V^0(\tau,X^{\pi N}(\tau-)(1-k \pi(\tau)))  \right] \\
%  \leq  & E_{t,x,n} \left[   V^0(\tau,X^{\pi' N}(\tau-)(1-k \pi'(\tau)))  \right] + \frac{\epsilon}{4}
% \end{split}
% \end{equation}

Wegen der $\epsilon$-Characterisierung des Surprememus können wir ein $\pi'(\tau)$ zu einem gegebenen $\tau$ mit
\begin{equation} \label{eq:pistrichchar}
       \sup_{\pi} E_{\tau,X(\tau),0} \left[ U(X_{\pi}(T)) \right] 
 \leq E_{\tau,X(\tau),0} \left[ U(X_{\pi'}(T)) \right]  + \frac{\epsilon}{2} 
\end{equation}
wählen. Wegen der $\epsilon$-Characterisierung des Infimums können wir ein $\tau'$ mit
\begin{equation} \label{eq:taustrichchar}
\begin{split} 
     & \inf_{\tau}    E_{t,x,n} \left[ V^0(\tau,X^{\pi \tau}(\tau)) \right] \\
\geq &  E_{t,x,n} \left[  V^0(\tau',X^{\pi \tau'}(\tau'))  \right] - \frac{\epsilon}{2}
\end{split}
\end{equation}
wählen.

% Halte ich ebenfalls für überflüssig	
% \begin{equation}
%  \inf_{N}    E \left[ U(X^{\pi,N}(T)) \right] 
% \geq  E \left[ V^0(\tau,X(\tau-)(1-k \pi(\tau))) \right] - \frac{\epsilon}{4}
% \end{equation}

Wir betrachten nun folgende Ungleichungskette. 
\begin{equation}
\begin{split}
      &   \sup_{\pi} \inf_{\tau}    E_{t,x,1} \left[ U(X_{\pi,\tau}(T)) \right] \\
\geq  &              \inf_{\tau}    E_{t,x,1} \left[ U(X_{\pi',\tau}(T)) \right] \\
\geq  &              \inf_{\tau}    E_{t,x,1} \left[ E_{\tau,X_{\pi',\tau}(\tau),0} \left[  U(X_{\pi',\tau}(T))
\right] \right] \\
\geq  &              \inf_{\tau}    E_{t,x,1} \left[ \sup_{\pi \in \mathcal{A}(\tau,X_{\pi',\tau}(\tau))} E_{\tau,X_{\pi',\tau}(\tau),0} \left[  U(X^{\pi,\tau}(T)) \right] \right] 
- \frac{\epsilon}{2} \\
\geq  &              \inf_{\tau}    E_{t,x,1} \left[ V^0(\tau,X_{\pi',\tau}(\tau)) \right]  - \frac{\epsilon}{2} \\
\geq  &                          E_{t,x,1} \left[ V^0(\tau',X_{\pi',\tau'}(\tau')) \right]  - \epsilon \\
\end{split}
\end{equation}
Dabei folgt die erste Ungleichung durch Verwenden von $\pi'$ statt das surpremum über alle Handeslstrategien zu nehmen. Die zweite Ungleichung folgt aus der Turmeigenschaft der
bedingten Erwartung. Die dritte Ungleichung folgt aus \ref{eq:pistrichchar}. Die vierte Ungleichung folgt aus der Definition von $V^0$. Die fünfte Ungleichung folgt aus
\ref{eq:taustrichchar}. 

Die Wahl von $\pi'$ hat nur Bedingungen für die Zeit nach $\tau$ gestellt. Vorher durfte $\pi$ beliebig gewählt werden. Deshalb können wir auf der rechten Seite das Surprememum
über alle handelsstrategien bilden und die Ungleichung bleibt erhalten.
\begin{equation}
\begin{split}
      &   \sup_{\pi} \inf_{N}    E_{t,x,1} \left[ U(X^{\pi N}(T)) \right] \\
\geq  &   \sup_{\pi}  E_{t,x,1} \left[ V^0(\tau,X^{\pi'' N}(\tau)) \right]  - \epsilon \\
\end{split}
\end{equation}
Nehmen des Infimum macht die rechten Seite nur kleiner und wir erhalten:
\begin{equation} \label{eq:Ungleichung1}
\begin{split}
      &   \sup_{\pi} \inf_{N}    E_{t,x,1} \left[ U(X^{\pi N}(T)) \right] \\
\geq  &   \inf_{N}   \sup_{\pi}  E_{t,x,1} \left[ V^0(\tau,X^{\pi'' N}(\tau)) \right]  - \epsilon \\
\end{split}
\end{equation}


Wir nehmen nun ein beliebiges $\tau$ und betrachten folgende Ungleichungskette:
\begin{equation}
\begin{split}
      &  \sup_{\pi}     E_{t,x,1} \left[ U(X_{\pi,\tau}(T)) \right] \\
 =  & \  \sup_{\pi}     E_{t,x,1} \left[ E_{\tau,X_{\pi,\tau}(\tau),0} \left[  U(X^{\pi N}(T))
\right] \right] \\
\leq &   \sup_{\pi}     E_{t,x,1} \left[  \sup_{\pi} E_{\tau,X_{\pi,\tau}(\tau),0} \left[  U(X_{\pi,\tau}(T))
\right] \right] \\
\leq &   \sup_{\pi}     E_{t,x,1} \left[ V^0(\tau,X_{\pi,\tau}(\tau))   \right] \\
\end{split}
\end{equation}

Infimum nehmen auf beiden Seiten führt dann zu:

\begin{equation} \label{eq:Ungleichung2}
\begin{split}
      & \inf_{\tau}  \sup_{\pi}     E_{t,x,1} \left[ U(X^{\pi N}(T)) \right] \\
 \leq  &   \inf_{\tau}        \sup_{\pi}     E_{t,x,1} \left[ V^0(\tau,X^{\pi'' N}(\tau))  \right] + \frac{\epsilon}{4} \\
\end{split}
\end{equation}

Jetzt haben wir folgende Ungleichungskette:
 \begin{equation}
 \begin{split}
       &   \sup_{\pi} \inf_{N}    E_{t,x,1} \left[ U(X^{\pi N}(T)) \right] \\
 \geq  &   \inf_{N}   \sup_{\pi}  E_{t,x,1} \left[ V^0(\tau,X^{\pi'' N}(\tau)) \right]  - \epsilon \\
 \geq  &    \inf_{N}  \sup_{\pi}     E_{t,x,1} \left[ U(X^{\pi N}(T)) \right]  - \epsilon\\
 \geq  &    \sup_{\pi}  \inf_{N}    E_{t,x,1} \left[ U(X^{\pi N}(T)) \right]  - \epsilon
\end{split}
\end{equation}
Dabei folgt die erste Ungleichung aus \ref{eq:Ungleichung1}, die zweite Ungleichung folgt aus \ref{eq:Ungleichung2} und die dritte Ungleichung aus der $ \sup \inf \leq \inf \sup$
Beziehung.

Da das $\epsilon$ beliebig gewählt war, bleibt hier jede Ungleichung auch ohne $\epsilon$ erhalten, da dann links und rechts von der Ungleichungskette das gleiche steht erhalten
wir also lauter Gleichheiten. Damit ist das Lemma bewiesen.
\end{proof}

\section{Verifikationsatz für das Portfoliooptimierungsproblem}
Im folgenden formulieren und beweisen wir einen Verfikationsatz.

\begin{mySatz}
Seien die Voraussetzungen von Satz \ref{th:Verifikationsatz} erfüllt.
Sei $v^1 \in C^{1,2}$ und seien $\mathcal{A}'(t,x)$ und $\mathcal{A}''(t,x)$ durch
\begin{align}
\mathcal{A}'(t,x) & = \{ 
                \pi : \pi \in R,  0 \leq \mathcal{L}^{\pi} v^1(t,x) 
                \} \\
\mathcal{A}''(t,x) & = \{ 
                  \pi : \pi \in R, v^1(t,x) \leq v^0(t,x(1-k\pi)) 
                 \} 
\end{align}
definiert. Es gelte für alle $(t,x)$
\begin{equation} \label{eq:HJB1-Ungleichung}
  0 \leq \sup_{\pi \in \mathcal{A}''(t,x)} \left[ \mathcal{L}^{\pi} v^0(t,x) \right]
\end{equation}
\begin{equation} \label{eq:HJB2-crashrelation}
 0 \leq \sup_{\pi \in \mathcal{A}'(t,x)} \left[ v^0(t,x(1-k\pi))-v^1(t,x) \right] 
\end{equation}
\begin{equation} \label{eq:HJB3-complementarity}
 0 = \sup_{\pi \in \mathcal{A}''(t,x)} \left[ \mathcal{L}^{\pi} v^0(t,x) \right]  
     \sup_{\pi \in \mathcal{A}'(t,x)} \left[ v^0(t,x(1-k\pi))-v^1(t,x) \right]
\end{equation}
und
\begin{equation}
 v^1(T,x) = U(x)
\end{equation}
Existiert eine zulässige Handelstrategie mit
\begin{equation}
 p(t,x) \in \mathcal{A}''(t,x)
\end{equation}
und
\begin{equation} \label{eq:optimale_Strategie}
  \mathcal{L}^{p(t,x)} v^1(t,x) = \sup_{\pi \in \mathcal{A}''(t,x)} \left[ \mathcal{L}^{\pi} v^0(t,x) \right]
\end{equation}
für alle $(t,x)$, 
Dann gilt $v^1(t,x)=V^1(t,x)$ und $p$ ist die optimale Strategie bis zum Crash.

% \begin{equation} \label{eq: optimaler_Crash}
%  \theta = \inf_s \left[ v^0(s,x(1-k \pi)) \leq v^1(t,x) \right]
% \end{equation}


\end{mySatz}


\begin{proof}
Wir beschreiben zunächst die Struktur des Beweises. Mit Hilfe der Ito-Formel können wir eine Relation zwischen $v^1(t,x)$ und den Werten von $v^1$ bis zum Crash herleiten
(vergleiche \ref{itov}). Durch Angabe einer optimalen Strategie und aus den Vorrausetzungen des Satzes gelingt es dann eine obere Schranke für $v^1(t,x)$ (vergleiche
\ref{eq:erstewichtigeUngleichung}) anzugeben, und genauso gelingt es durch Angabe eines optimalen Crashes eine untere Schranke für $v^1(t,x)$ (vergleiche
\ref{eq:zweitewichtigeUngleichung}) herzuleiten. Diese Schranken falllen zusammen und charakterisieren nach dem vorangegangen Lemma die optimale Wertfunktion. Das die optimale
Strategie wirklich optimal ist folgt dann aus einem auf dem Weg gewonnenen Ergebnis. Diesen Plan führen wir nun aus: 
 
Wir gehen davon aus, das in $(t,x)$ für das Vermögen $X(t)=x$ gilt und noch ein Crash möglich ist.
Anwendung der Ito-formel ergibt dann:
\begin{equation} 
 dv^1(s,X_{\pi,\tau,t,x}(s))=\mathcal{L}^{\pi(s)}v(s,X_{\pi,\tau,t,x}(s))ds + v_x^1(s,X_{\pi,\tau,t,x}(s)) \sigma X(s) dW(s)
\end{equation}
und
\begin{equation}
 dv^1(\tau,X(\tau))= v^1(\tau,X(\tau))(1-\pi(\tau)k) - v^1(\tau-,X(\tau-))
\end{equation}
also
\begin{equation} \label{itov}
\begin{split}
 & v^1(\tau-,X(\tau-)) - v^1(t,x) \\
= & \int_t^{\tau} \mathcal{L}^{\pi(s)}v(s,X(s))ds
                            +   \int_t^{\tau} v_x^1(s,X(s)) \sigma X(s) p(s) dW(s) 
\end{split}
\end{equation}
Wir fixieren nun die Strategie $p$ aus den Vorausetzungen des Satzes. Dann folgt aus der der Vorrausetzung \ref{eq:optimale_Strategie}
an $p$ und der HJB-ungleichung \ref{eq:HJB1-Ungleichung} für $t \leq s \leq \tau$:
\begin{equation} \label{rauch}
 0 \leq \sup_{\pi \in \mathcal{A}''(s,X(s))} \left[ \mathcal{L}^{\pi} v^1(s,X(s)) \right] = 
  \left[ \mathcal{L}^{p(s,X(s)} v^1(s,X(s)) \right]
\end{equation}
und da $p(s,X(s)) \in \mathcal{A}''(s,X(s))$
\begin{equation} \label{schall}
  v^1(s,X(s)) \leq v^0(s,X(s)(1-k  p(s,X(s)))
\end{equation}

Wenn wir nun $p$ in \ref{itov} einsetzen und die Gleichung nach $v^1(t,x)$ umstellen, erhalten wir:
\begin{equation}
\begin{split}
  v^1(t,x) &= v^1(\tau-,X(\tau-)) - \int_t^{\tau} \mathcal{L}^{p(s,X(s))}v(s,X(s))ds \\
           &-   \int_t^{\tau} v_x^1(s,X(s)) \sigma X(s) p(s) dW(s) 
\end{split}
\end{equation}

Mit \ref{schall} können wir den ersten Summanden auf der rechten Seite nach oben abschätzen, den zweiten
Summanden können wir wegen \ref{rauch} durch Weglassen nach oben abschätzen und erhalten:
\begin{equation}
 v^1(t,x) \leq v^0(\tau,X(1-k p(\tau)) -  \int_t^{\tau} v_x^1(s,X(s)) \sigma X(s) dW(s) 
\end{equation}
Bilden des Erwartungswertes führt dann zu:
\begin{equation} \label{ungleichung}
 v^1(t,x) \leq E_{t,x} \left[ v^0(\tau,X(1-k\pi(\tau))  \right] 
\end{equation}
Ausgehend von \ref{ungleichung} vergrößern wir die rechte Seite durch Bilden des Surprememums über alle
Handelsstrategien:
\begin{equation} 
 v^1(t,x) \leq \sup_{\pi} E_{t,x} \left[ v^0(\tau,X(1-k\pi(\tau))  \right] 
\end{equation}
Da da das $\tau$ beliebig gewählt war erhaält nun auch das bilden des infimums auf er rechten Seite die
Ungleichung:
\begin{equation} \label{eq:erstewichtigeUngleichung} 
 v^1(t,x) \leq \inf_{\tau} \sup_{\pi} E_{t,x} \left[ v^0(\tau,X(\tau)  \right] 
\end{equation}

% Ist glaube ich erstmal nicht nötig

% Wieder ausgehend von \ref{ungleichung} können wir die beiden letzten Schritte auch in umgekehrter Reihenfolge
% durchführen. Da $\tau$ beliebig gewählt war erhält das Bilden des Infimums auf der rechten Seite von
% \ref{ungleichung} die Ungleichung und wir erhalten
% \begin{equation} 
%  v^1(t,x) \leq \inf_{\tau} E_{t,x} \left[ v^0(\tau,X(1-k\pi(\tau))  \right] 
% \end{equation}
% und bilden des Surprememus über alle Handelstrategien macht die rechte Seite davon nur größer
% 
% \begin{equation} 
%  v^1(t,x) \leq \sup_{\pi} \inf_{\tau} E_{t,x} \left[ v^0(\tau,X(1-k\pi(\tau))  \right] 
% \end{equation}

Sein nun $\pi$ wieder eine beliebige Handelsstrategie. Dann fixieren wir dazu die Stoppzeit
\begin{equation}
 \theta(\pi) = \inf \{s \in R; v^0(s,X(s)(1-\pi(s))) \leq v^1(s,X(s)) \}
\end{equation}
wobei $X$ der Dynamik ohne $N$ folgt.


Wir fixieren nun $\theta$. Nach definition von $\theta$ gilt für $t\leq s < \theta$
\begin{equation} \label{super}
 v^0(s,X(s)(1-k \pi(s))) > v^1(s,X(s))
\end{equation}
und
\begin{equation} \label{duper}
 v^0(\theta,X(\theta)(1-k \pi(\theta))) \leq v^1(\theta,X(\theta))
\end{equation}
Nun muss entweder
\begin{equation} \label{hanni}
 \mathcal{L}^{\pi(s,X(s))} v_1(s,X(s)) < 0 
\end{equation}
oder 
\begin{equation} \label{nanni}
 0 \leq \mathcal{L}^{\pi(s,X(s))} v_1(s,X(s))
\end{equation}
gelten.
Gilt letzteres, so ist $\pi(s,X(s)) \in \mathcal{A}'(s,X(s)) $ und aus \ref{super} folgt

\begin{equation} 
 \sup_{\pi \in \mathcal{A}''(s,X(s))} \left[ v^0(s,X(s)(1-k\pi))-v^1(s,X(s)) \right] > 0 
\end{equation}

Wegen \ref{complementarity} folgt dann 
\begin{equation}
 0 = \sup_{\pi \in \mathcal{A}''(s,X(s))} \left[ \mathcal{L}^{\pi} v^1(s,X(s)) \right] 
\end{equation}

Aber wegen \ref{super} ist $\pi(s,X(s)) \in \mathcal{A}''(s,X(s))$ und es folgt

\begin{equation}
 \mathcal{L}^{\pi(s,X(s))} v_1(s,X(s)) \leq 0 
\end{equation}

Also unabhängig ob \ref{hanni} oder \ref{nanni} gilt, es folgt
\begin{equation} \label{shappi}
 \mathcal{L}^{\pi(s,X(s))} v_1(s,X(s)) \leq 0 
\end{equation}

Wenn wir nun $\theta$ in \ref{itov} einsetzen und die Fleichung nach $v(t,x)$ umstellen erhalten wir 
\begin{equation}
\begin{split}
v^1(t,x) &= v^1(\theta,X(\theta)) - \int_t^{\theta} \mathcal{L}^{\pi(s)}v(s,X(s))ds \\
         & -   \int_t^{\theta} v_x^1(s,X(s)) \sigma X(s) dW(s)
\end{split}
\end{equation}
Mit \ref{duper} können wir den ersten Summanden auf der rechten Seite verkleinern, und wegen \ref{shappi}
wird die rechte Seite durch Weglassen des zweiten Summanden ebenfalls nur kleiner. So erhalten wir
\begin{equation}
 v^1(t,x) \geq v^0(\tau-,X(\tau-))  -   \int_t^{\tau} v_x^1(s,X(s)) \sigma X(s) dW(s) 
\end{equation}

 
 Bildung des erwartungwertes führt zu
 \begin{equation} \label{ungleichung2}
  v^1(t,x) \geq E_{t,x} \left[ v^0(\tau-,X(\tau-)) \right]
 \end{equation}

% nächster unnötiger Teil
% Wie im ersten Teil des Beweises nehmen wir nun surprema und infina:
% Bilden des Infimums über alle Crashzeiten macht die rechte Seite von \ref{ungleichung2} nur kleiner.
%  \begin{equation} 
%   v^1(t,x) \geq \inf_{\tau} E_{t,x} \left[ v^0(\tau-,X(\tau-)) \right]
%  \end{equation}
%  Da $\pi$ beliebig gewählt war, bleibt die Ungleichung durch Bildung des Surpremums über alle Handelstrategie
% erhalten:
% \begin{equation} 
%  v^1(t,x) \geq \sup_{\pi} \inf_{\tau} E_{t,x} \left[ v^0(\tau-,X(\tau-)) \right]
% \end{equation}

Ausgehend von \ref{ungleichung2} können wir mit den gleichen Argument wie  in der verherigen Gleichung
das Surpremum über alle handelsstrategien bilden.
\begin{equation} 
 v^1(t,x) \geq \sup_{\pi}  E_{t,x} \left[ v^0(\tau-,X(\tau-)) \right]
\end{equation}
Und das Bilden des Infimums macht die rechte Seite nur kleiner.
\begin{equation} \label{eq:zweitewichtigeUngleichung}
 v^1(t,x) \geq \inf_{\tau} \sup_{\pi}  E_{t,x} \left[ v^0(\tau,X(\tau)) \right]
\end{equation}

Nun folgt aus \ref{eq:erstewichtigeUngleichung} und \ref{eq:zweitewichtigeUngleichung}
\begin{equation} \label{eq:zweitewichtigeUngleichung}
 v^1(t,x) = \inf_{\tau} \sup_{\pi}  E_{t,x} \left[ v^0(\tau,X(\tau)) \right]
\end{equation}
Nach dem vorangegangen Lemma folgt dann also $V^1 = v^1$.

Es bleibt noch die Optimalität der Strategie zu zeigen: Ausgehend von \ref{ungleichung} können wir, da $\tau$ beliebig gewählt war, auf der rechten Seite das Infimum bilden und wir
erhalten
\begin{equation}
 v^1(t,x) \leq \inf_{\tau} E_{t,x} \left[ v^0(\tau,X_{p,\tau}(\tau-)(1-k\pi(\tau))  \right] 
\end{equation}
Das bedeutet aber gerade das die Strategie optimal ist.
\end{proof}





% Ab hier nochmal ganz von vorne

\section{Logaritmischer Nutzen}
Wir zeigen nun, dass die Lösung von
\begin{align*}
 \pidach_t &=\frac{1}{k} (1- \pidach^1 k) 
  \left(
   \pidach (\mu-r) - \einhalb \left[ \bruch^2 + (\pidach^1)^2 \sigma^2 \right] 
  \right) \\
 \pidach(T) &=0
\end{align*}
und
\begin{align*} 
f^1_t(t) &=  -(r+\pidach (\mu-r)) + \einhalb (\pidach)^2 \sigma^2 \\
f^1(T) &=0
\end{align*}
und
\begin{equation}
 V^1(t,x) = \log(x) + f^1(t)
\end{equation}
alle Vorrausetzungen des Verifikationsatzes erfüllen.
Zunächst zeigen wir, dass damit
\begin{equation*}
 V^1(t,x)=V^0(t,x(1-k \pi(t,x))
\end{equation*}
gilt. Dazu halten wir $x$ fest und betrachten beide Seiten als Funktionen von $t$. Für $t=T$ gilt:
\begin{equation*}
 V^1(T,x)= \log x = V^0(T,x) = V^0(T,x(1-k \pi(T,x))
\end{equation*}
Ableiten der rechten Seite ergibt
\begin{equation*}
\begin{split}
& \frac{d}{dt} \left[ ( V^0(t,x(1-k \pi(t,x)) ) )  \right] \\
= & \frac{d}{dt} \left[ \log x + \log (1-k\pi(t)) + \left( r + \einhalb \bruch^2 \right) (T-t) \right] \\
= & \frac{-k \pi_t}{1-k \pi} - r - \einhalb \bruch^2 \\
= & \einhalb  \bruch^2 + (\pidach)^2 \sigma^2  - \pidach (\mu-r)- r - \einhalb \bruch^2 \\
= &(\pidach)^2 \sigma^2  - \pidach (\mu-r)- r = f^1_t(t)  \\
\end{split}
\end{equation*}
und das ist offensichtlich die Ableitung der rechten Seite von der Gleichgewichtsbeziehung und damit ist diese Bezeigung gezeigt.

Die Beziehung
\begin{equation} 
 V^1_t(t,x) = -V^1_x(t,x)(r+\pi(\mu-r))x - \einhalb V^1_{xx}(t,x) \pi^2 \sigma^2 x^2
\end{equation}
kann man duch Einsetzen der entsprechenden Ableitungen sofort überprüfen.
Also gilt für alle $(t,x)$
\begin{equation*}
 \pidach(t,x) \in \mathcal{A}'(t,x)
\end{equation*}
und
\begin{equation*}
 \pidach(t,x) \in \mathcal{A}''(t,x)
\end{equation*}
Also gilt die HJB-Ungleichung \eqref{eq:HJB-Ungleichung} und die Gleichgewichtsbeziehung \eqref{eq:Gleichgewichtsbedingung} aus den Vorausetzungen des Verifikationssatzes. Es
bleibt noch die Bedingung \eqref{complementarity} zu überprüfen.
dazu werden wird
\begin{equation}
 \sup_{\pi \in \mathcal{A}'(t,x)} \left[ v^0(t,x(1-k\pi))-v^1(t,x) \right] =0
\end{equation} 
zeigen.
Dazu berechnen wir zunäcst
\begin{equation}
\begin{split}
  & \mathcal{A}'(t,x)  \\
 =& \{ 
     \pi :  0 \leq \mathcal{L}^{\pi} V^1(t,x) 
     \} \\
=& \{ 
     \pi :  0 \leq -(r+\pidach (\mu-r)) + \einhalb (\pidach)^2 \sigma^2 + r - (\mu -r) \pi + \einhalb \pi^2 \sigma^2
     \} \\
=& \{ 
     \pi :  0 \leq -f(\pidach) + f(\pi)
     \} \\
=& \{ 
     \pi :  \pidach \leq  \pi
     \} \\
\end{split}
\end{equation}

Wir haben schon
\begin{equation}
 f^1(t) = log(1 - k \pidach(t)) + f^0(t)
\end{equation}
gezeigt. Ersetzen wir $\pidach$ durch ein $\pi$ aus $\mathcal{A}'(t,x)$, so wird die rechte Seite kleiner, und wir erhalten durch Addieren von $ \log x$

\begin{equation}
V^0(t,x(1-\pi(t) k)) \leq V^1(t,x),
\end{equation}
das Surpremum wird also tatsächlich in $\pidach$ angenommen und es gilt
\begin{equation}
 \sup_{\pi \in \mathcal{A}'(t,x)} \left[ v^0(t,x(1-k\pi))-v^1(t,x) \right] =0
\end{equation}
Wir zeige nun noch das $\pidach$ die eine Gleichung das surpremum annimmt.
Wir berechnen:
\begin{equation}
\begin{split}
  & \mathcal{A}''(t,x)  \\
 =& \{ 
     \pi :   V^1(t,x) \leq V^0(t,x(1-k \pi)) 
     \} \\
=& \{ 
     \pi :  f^1(t) \leq \log(1-k \pi) + f^0(t)
     \} \\
=& \{ 
     \pi :  \pi \leq \pidach
     \} 
\end{split}
\end{equation}
Dabei ergibt sich die letzte Gleichheit, da genau für $\pidach$ in der die Menge definierenden Ungleichung Gleichheit herrscht und die rechte Seite monoton falllend in $\pi$ ist.
\begin{equation}
\begin{split}
 & \mathcal{L}^{p(t,x)} v^1(t,x) \\
 = & f_t + r + \pi (\mu -r) - \einhalb \pi^2 \sigma^2 \\
 = & f_t + r + f(\pi) \\
\end{split}
\end{equation}
Da $f$ aber monoton wachsend bis $\pistar$ ist und $\pidach \leq \pistar$ gilt wird das Surpremum tatsächlich mit $\pidach$ angenommen.


Damit sind alle Vorrausetzungen des Verifikationssatzes erfüllt und wir haben gezeigt

\section{Vergleich der beiden Ansätze}
Zunächst einige Bemerkungen zum stochastischen Modell. 
Im ersten Ansatz wurde der Crash nicht in das stochastische Modell des Aktienkurses mit aufgenommen. Es wurde heuristisch
argumentiert, wie das Endvermögen aussieht, wenn ein Crash zur Zeit $t$ geschieht und dann einfach das Infimum über alle möglichen Zeitpunkte genommen. Damit war es auch nicht
möglich zu formulieren wie eine Handelstrategie auf einem Crash reagieren kann und wie mussten das Problem mit $V^0$ formulieren. 
Im zweiten Ansatz hingegen war der Crash im Aktienkurs modelliert, das Endvermögen ergibt sich aus der Lösung der Differentialgleichung, die Formulierung des Optimierungsproblems
ist viel weniger schwerfällig und das Bellmanprinzip aus Satz \ref{th:Bellmanprinzip} konnten wir beweisen anstatt er vorausetzen zu müssen. Allerdings haben wir dabei auch
Sprungprozesse im Integrator des stochastischen Integrals gehabt, während wir beim ersten Ansatz nicht über das Ito-Kalkül hinausgehen mussten.
Mit dem ersten Ansatz konnten wir eine Lösung nur für den Fall des logaritmischen Nutzen angeben, an einigen Stellen im Beweis werden Eigenschaften des Logarithmuses ausgenutzt.
Dafür wird im Beweis genau klar, was passiert, dass jede Strategie die nicht mit der Gleichgewichtsbedingung ausbalnaciert ist eine nierigere Worst-Case-Scranke besitzt.
Beim zweiten Ansatz wird dieses Motiv viel weniger deutlich, auch wenn in der einen Gleichung die Gleichgewichtsbedingung steht. Dafür kann man das Ergebnis als eine
Verallgemeinerung des gewöhnlichen HJB-Ansatz sehen und wir mussten auch nicht die Nutzenfunktion spezifizieren.

